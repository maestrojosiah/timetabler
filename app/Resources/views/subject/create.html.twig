{% extends 'base.html.twig' %}
{% block pagewrapper %}
    {% set action_title = "Add Subjects" %}
    {% embed "templates/pagewrapper.html.twig" %}
        {% block toplinks %}
        {% endblock %}
        {% block charts %}
        {% endblock %}
            {% block otherstuff_lg12 %}
              {# {{ dump(data) }} #}
      <div class="col-md-6">
          <!-- general form elements -->
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">Add Subjects</h3>
            </div>
            <!-- /.box-header -->
            <!-- form start -->
              <div class="box-body">

            <a href="{{path('list_teachers',{'tbl': data.timetable.id })}}" class="btn btn-info">Teachers List</a>
            <a href="{{path('list_subjects',{'tbl': data.timetable.id })}}" class="btn btn-info">Subjects List</a>

            {{ form_start(form, {'method': 'post', 'attr': {'class': '' }} ) }}
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                    {% if not form.vars.valid %}
                      <div class="alert alert-warning">
                      {{ form_errors(form) }}
                      </div>        
                    {% endif %}
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-6">
                                 <div class="form-group">
                                    <label>Subject Title</label>
                                      {{ form_widget(form.s_title, {'attr': {'class': 'form-control', 'placeholder': 'Subject Title', 'id': 'subjecttitle' }} ) }}
                                    </div>
                                    <!-- /.col-lg-6 (nested) -->

                            </div>
                            <!-- /.row (nested) -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
            </div>
              </div>
              <!-- /.box-body -->

              <div class="box-footer">
                  {{ form_widget(form.save, {'attr': {'class': 'btn btn-primary' }} ) }}
                  {{ form_widget(form.saveAndAdd, {'attr': {'class': 'btn btn-info' }} ) }}                               
                  <a href="{{path('homepage')}}" class="btn btn-danger">DONE</a>
              </div>
          </div>
               {{ form_end(form) }}
        </div>
        {% if app.user.timetables|length > 1 %}
      <div class="col-md-6">
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">Copy from another timetable</h3>
            </div>
            <!-- /.box-header -->
            <!-- form start -->
              <div class="box-body">
          
                <div class="col-md-12">
                  <p class="text-center">
                    <strong>Use Subjects From Another Timetable</strong>
                  </p>
                  <div class="col-md-9">
                    <select id="timetables" class="form-control">
                      {% for timetbl in app.user.timetables %}
                        {% if timetbl.id != data.timetable.id %}
                          <option value="{{timetbl.id}}">{{timetbl.title}}</option>
                        {% endif %}
                      {% endfor %}
                    </select>               
                  </div>
                  <div class="col-md-3">
                    <button id="choose_from_this_timetable" class="btn btn-info"> NEXT </button>
                  </div>
                  <!-- /.progress-group -->
                </div> 
              </div>
          </div>
          <!-- /.box -->

        </div>
      {% endif %}
        
          <!-- /.box -->
      <div class="col-md-6">
          <!-- general form elements -->
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">Added Subjects</h3>
            </div>
            <!-- /.box-header -->
            <!-- form start -->
              <div class="box-body">
                <ol>
                  {% for subject in data.subjects %}
                    <li>{{subject}}</li>
                  {% endfor %}
                </ol>
              </div>
              <!-- /.box-body -->

              <div class="box-footer">
                *************************
              </div>
          </div>
          <!-- /.box -->
        </div>

        {% endblock %}
    {% endembed %}
{% endblock %}
{% block javascripts %}
  <script type="text/javascript">
    $(function() {
      $("#subject_s_title").focus();
    });    
  </script>
  <script>
      $(document).on('click', '#choose_from_this_timetable', function(){
        var other_timetable = $('#timetables').val();
        var this_timetable = {{data.timetable.id}};
        var entity = 'Subject';
        $.ajax({
            url:'{{ (path('take_classes_from_this_timetable')) }}',
            type: "POST",
            dataType: "json",
            data: {
                "other_timetable": other_timetable,
                "this_timetable": this_timetable,
                "entity": entity,
            },
            async: true,
            success: function (data)
            {
               location.href = data.url
            },  
          error: function () {
                $("#info").html("<b>something's wrong</b>");
          }
        });

    });
  </script>

{% endblock %}
