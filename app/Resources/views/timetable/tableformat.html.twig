{% extends 'base_collapse.html.twig' %}
{% block stylesheets %}

    <!-- DataTables CSS -->
    <link href="{{ asset('vendor/datatables-plugins/dataTables.bootstrap.css') }}" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="{{ asset('vendor/datatables-responsive/dataTables.responsive.css') }}" rel="stylesheet">

{% endblock %}

{% block pagewrapper %}
	{# {{dump(lesson_series)}} #}
{# 	{{dump(items)}}
	{{dump(tableformats)}}
	{{dump(lesson_series)}}
 #}	{% set action_title = "Full timetable" %}
    {% embed "templates/pagewrapper.html.twig" %}
        {% block toplinks %}
        {% endblock %}

        {% block charts %}
{# grade 1 - Rhoda 2 - Esther 3 - Moses PP1 - Lilian PP2 - Mercy #}

<style>
 	th, td {
    	border: 1px solid black;
     	border-collapse: collapse;
   	} 
   	td, th{
   		padding:0px;
   		text-align: center;
   		text-transform: uppercase;
   	}

   	#page-wrapper{
   		margin:0px;
   	}

	.rotate {
	  text-align: center;
	  white-space: nowrap;
	  vertical-align: middle;
	  width: 1.5em;
	}

	.rotate div {
	     -moz-transform: rotate(-90.0deg);  /* FF3.5+ */
	       -o-transform: rotate(-90.0deg);  /* Opera 10.5 */
	  -webkit-transform: rotate(-90.0deg);  /* Saf3.1+, Chrome */
	             filter:  progid:DXImageTransform.Microsoft.BasicImage(rotation=0.083);  /* IE6,IE7 */
	         -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0.083)"; /* IE8 */
	         margin-left: -10em;
	         margin-right: -10em;
	}
	.full_width tr td {
		display:block; 
     	width:100%;
     	clear:both;

	}
</style>
{# table starts here #}
<div class="panel panel-default">
    <div class="panel-heading">
       	{% set counter = 0 %}
       	| <a href="{{path('list_teachers', {'tbl':timetable.id})}}" >Teachers: </a>
       	{% if tableformats|first %}
       	{% for teacher in tableformats[0].timetable.teachers %}
       		<a type="button" id="teacher-details-{{teacher.id}}" class="btn btn-success btn-xs" data-toggle="modal" data-target="#teacherModal_{{teacher.id}}" style="background-color:{{teacher.color}}">{{teacher.fName}} {{teacher.lName}}</a>
       	{% endfor %}
       	| <a href="{{path('pdf_timetable', {'tbl':tableformats[0].timetable.id })}}" class="btn btn-primary"> Download PDF </a>
       	| <a href="{{path('image_timetable', {'tbl':tableformats[0].timetable.id})}}" class="btn btn-primary">Download as Image </a>
       	{% endif %}
       	| <a href="{{path('homepage')}}" class="btn btn-default">Home Page</a>
       	| <input type="checkbox" id="forceEntry" style="outline:1px solid black;">
		      <b> FORCE</b>
       	| <input type="checkbox" id="showHints" style="outline:1px solid black;" checked>
		      <b> HINTS</b>
       	| <button type="button" data-toggle="modal" data-target="#auto_modal" class="btn btn-info btn-xs">Auto</a>
    </div>
    <!-- /.panel-heading -->
    <div class="panel-body">
        <div class="">

        	{% set days_per_week = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'] %}

            <table  style="width:100%;">

                <thead>
                    <tr>
                        <th id="day">Day</th>
                        <th id="class">Class</th>
                        {% for lesson_time in lesson_series %}
                        	<th id="activity_{{lesson_time|split('|')[1]}}">{{lesson_time|split('|')[0]}}</th>
                        {% endfor %}
                    </tr>
                </thead>

        		{% for day in days_per_week %}
                <tbody>
                	{% set height = classes|length * 30 %}
                    {% if height < 150 %}
                        {% set height = 150 %}
                    {% endif %}
                    <tr style="height:{{height}}px;" class="success">
                        <td class="rotate"><div>{{day|slice(0,3)}}</div></td>
                        <td>
                        	<table style="margin-bottom:0px;" class="table table-striped table-bordered table-hover">
                        		{% for class in classes %}
	                        		<tr id="class-{{class}}_day-{{day}}">
	                        			<td style="padding:2px;" id="class_">{{class}}</td>
	                        		</tr>
	                        	{% endfor %}
                        	</table>
                        </td>
                        {% set counterz = 0 %}
                        {% for tableformat in tableformats %}
                        	{% if tableformat.activity == 'lesson' %}
		                        <td id="with_children">
		                        	<table style="margin-bottom:0px;" class="full_width table table-bordered table-hover">
		                        		{% set counter = 0 %}
		                        		{% for class in classes %}
			                        		<tr style=" " id="class-{{class}}_day-{{day}}_tblfmt-{{tableformat.id}}" data-toggle="modal" data-target="#timetableModal_{{class}}_{{day}}_{{tableformat.id}}">
			                        				{% set key = tableformat.id ~ "." ~ class ~ "." ~ day %}
			                        				{% if items[key] is defined %}
			                        					{% set subject = items[key]|split("|")[0] %}
			                        					{% set color = items[key]|split("|")[1] %}
			                        				{% else %}
			                        					{% set subject = 'No Subject' %}
			                        					{% set color = '' %}
			                        				{% endif %}
			                        				
			                        			<td class="class-{{class}}_day-{{day}}_tblfmt-{{tableformat.id}}" style="padding:2px; cursor:pointer; background-color:{{color}}; font-size:15px; font-weight:bold;">
			                        				{{ subject }}
			                        			</td>
			                        			{# Modal for every tr #}

													<div class="modal fade" id="timetableModal_{{class}}_{{day}}_{{tableformat.id}}" tabindex="-1" role="dialog" aria-labelledby="timetableModalLabel" aria-hidden="true" style="display: none;">
													    <div class="modal-dialog">
													        <div class="modal-content">
													            <div class="modal-header">
													                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
													                <h4 class="modal-title" id="timetableModalLabel">Place Subject</h4>
													            </div>
													            <div class="modal-body text-center">
													                <div class="list-group">
													                	{% for classSubj in tableformat.timetable.classSubjects %}
													                		{# {{dump(classSubj)}} #}
													                		{% if classSubj.cClass == class %}
													                			<a href="#" id="classSubj_{{classSubj.id}}|subj_{{classSubj.subject.id}}|time_{{lesson_series[counterz]|split('|')[0]}}|tbl_{{timetable.id}}|day_{{day}}|frmtcol_{{tableformat.id}}" 
													                				style="background-color:{{classSubj.teacher.color}}" 
													                				class="list-group-item list-group-item-action" 
													                				data-dismiss="modal">
													                				<span style="text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white; font-weight:bold;">{{classSubj.subject.sTitle}} ({{classSubj.teacher.fName}}{{classSubj.teacher.lName}}) </span>
													                			</a>
													                		{% endif %}
													                	{% endfor %}
													                	<hr />
																		<div class="row">
																			<h3>Fix a Quick Lesson</h3>
																		    <div class="col-sm-4">
																		        <div class="form-group">
																		            <select class="form-control fixSubject">
																		            	<option value="">Select Subject</option>
																		            	{% for subject in tableformat.timetable.subjects %}
																		                	<option value="{{subject.id}}">{{subject.sTitle}}</option>
																		                {% endfor %}
																		            </select>
																		        </div>
																		    </div>
																		    <div class="col-sm-4">
																		        <div class="form-group">
																		            <select class="form-control fixTeacher">
																		            	<option value="">Select Teacher</option>
																		            	{% for teacher in tableformat.timetable.teachers %}
																		                	<option value="{{teacher.id}}">{{teacher}}</option>
																		                {% endfor %}
																		            </select>
																		        </div>
																		    </div>
																		    <div class="col-sm-4">
																		        <div class="form-group">
																					<button id="fixLesson_{{tableformat.id}}|class_{{class.id}}|day_{{day}}|tblfmt_{{tableformat.id}}|time_{{lesson_series[counterz]|split('|')[0]}}|cls_{{class}}" type="button" data-dismiss="modal" class="btn btn-primary">Place Lesson</button>
																		        </div>
																		    </div>
																		</div>
																	  <a href="#" class="list-group-item list-group-item-action" id="removeDay_{{day}}|class_{{class.id}}|time_{{lesson_series[counterz]|split('|')[0]}}|tblfmt_{{tableformat.id}}" data-dismiss="modal">Remove Lesson</a>
													                  <a href="{{ path('list_teachers', {'tbl':timetable.id }) }}" class="list-group-item list-group-item-action">Add Lessons for Timetable</a>
													                </div>
													            </div>
													            <div class="modal-footer">
													                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
													            </div>
													        </div>
													        <!-- /.modal-content -->
													    </div>
													    <!-- /.modal-dialog -->
													</div>

			                        		</tr>
		                        			{% set counter = counter + 1 %}
			                        	{% endfor %}
		                        	</table>
		                        </td>
		                    {% else %}
		                        <td class="rotate" rowspan="1">
		                        	<div>{{tableformat.title}}</div>
		                        </td>
	                    	{% endif %}
	                    	{% if counterz <= lesson_series|length %}
	                    		{% set counterz = counterz + 1 %}
	                    	{% endif %}
                        {% endfor %}
                    </tr>
                </tbody>

        		{% endfor %}

            </table>
        </div>
        <!-- /.table-responsive -->
    </div>
    <!-- /.panel-body -->
</div>
{# table ends here #}
{% for teacher in tableformats[0].timetable.teachers %}
<div class="modal modal-success fade" id="teacherModal_{{teacher.id}}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color:{{teacher.color}}!important">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span></button>
        <h4 class="modal-title">{{teacher}}</h4>
      </div>
      <div class="modal-body-{{teacher.id}}">
		
      </div>
      <div class="modal-footer" style="background-color:{{teacher.color}}!important">
        <button type="button" class="btn btn-outline pull-right" data-dismiss="modal">Close</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
{% endfor %}
<div class="modal fade" id="auto_modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span></button>
        <h4 class="modal-title">Lessons Per Week. Automatic Placement</h4>
      </div>
      <div class="modal-body">
		<div class="row">
		    <div class="col-sm-4">
		        <div class="form-group">
		           <input type="text" class="form-control col-sm-4" placeholder="Number of Lessons Per Week" id="auto_quantity" />
		        </div>
		    </div>
		    <div class="col-sm-4">
			    <select class="col-sm-4 form-control auto_subject">
		        	<option value="">Select Lesson</option>
		        	{% for subject in timetable.subjects %}
		            	<option value="{{subject.id}}">{{subject.sTitle}}</option>
		            {% endfor %}
		        </select>
		    </div>
		    <div class="col-sm-4">
			    <select class="col-sm-4 form-control auto_class">
		        	<option value="">Select Class</option>
		        	{% for class in timetable.classes %}
		            	<option value="{{class.id}}">{{class.cTitle}}</option>
		            {% endfor %}
		        </select>
		    </div>
		</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger pull-left" data-dismiss="modal">Close</button>
        <button type="button" id="auto" class="btn btn-primary" {# data-dismiss="modal" #}>Go Ahead</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
 <input id="teacherFixed" type="hidden" />
<input id="subjectFixed" type="hidden" />
       {% endblock %}
    {% endembed %}
{% endblock %}
{% block javascripts %}
    <!-- DataTables JavaScript -->
    <script src="{{ asset('vendor/datatables/js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ asset('vendor/datatables-plugins/dataTables.bootstrap.min.js') }}"></script>
    <script src="{{ asset('vendor/datatables-responsive/dataTables.responsive.js') }}"></script>

    <script>
    $(document).ready(function() {
        $('#dataTables-example').DataTable({
            responsive: true
        });
    });
    </script>

  	<script>
  	    $(document).on('click', '[id^="classSubj_"]', function(){
  	    	var id = jQuery(this).attr("id");

				if ($('#forceEntry').is(':checked')) {
			        var forced = 'true';
			    } else {
			        var forced = 'false';
			    }

			    $.ajax({
	          	url:'{{ (path('save_timetable_entry')) }}',
	          	type: "POST",
	          	dataType: "json",
	          	data: {
	              	"info": id,
	              	"forced": forced,
	          	},
	          	async: true,
	          	success: function (data)
	          	{
	              	console.log(data.output['string']);
	              	$("."+data.output['string']).css(
	              		{
	              			"background-color" : data.output['color'],
	              			"font-size" : "15px",
	              			"font-weight" : "bold",
	              			"padding" : "2px",
	              			"border" : "1px solid fff"
	              		}).text(data.output['subject']);
	              	// $("#info").html(data.message);
	              	$.notiny({ 
		            	text: data.message,  
		            	position: 'right-top',
		            	delay: 5000,
		            	theme: data.theme
		            });
	          	},	
	         	error: function () {
	              	$("#info").html("<b>something's wrong</b>");
	       	 	}
	      	});

	  	});
  	</script>

  	<script>
  	    $(document).on('click', '[id^="removeDay_"]', function(){
  	    	var id = jQuery(this).attr("id");
	      	$.ajax({
	          	url:'{{ (path('remove_timetable_entry')) }}',
	          	type: "POST",
	          	dataType: "json",
	          	data: {
	              	"info": id,
	          	},
	          	async: true,
	          	success: function (data)
	          	{
	              	$.notiny({ 
		            	text: data.message,  
		            	position: 'right-top',
		            	delay: 5000,
		            	theme: 'dark'
		            });
		            $("."+data.id).html('<td style="padding:2px; cursor:pointer; background-color:#ffffff; font-size:15px; font-weight:bold;">NO SUBJECT</td>');
	          	},	
	         	error: function () {
	              	$("#info").html("<b>something's wrong</b>");
	       	 	}
	      	});

	  	});
  	</script>

  	<script>
  	    $(document).on('click', '[id^="class-"]', function(){
  	    	var id = jQuery(this).attr("id");
	      	$.ajax({
	          	url:'{{ (path('give_hints')) }}',
	          	type: "POST",
	          	dataType: "json",
	          	data: {
	              	"info": id,
	              	"timetable": {{timetable.id}},
	          	},
	          	async: true,
	          	success: function (data)
	          	{
	          		if ($('#showHints').is(':checked')) {
				        $.notiny({ 
			            	text: data,  
			            	position: 'left-top',
			            	delay: 5000,
			            	theme: 'dark'
			            });
				    } else {
				        //do nothing
				    }
			        console.log(data);
	          	},	
	         	error: function () {
	              	$("#info").html("<b>something's wrong</b>");
	       	 	}
	      	});

	  	});
  	</script>

  	<script>
  	    $(document).on('click', '[id^="teacher-details-"]', function(){
  	    	var id = jQuery(this).attr("id");
	      	$.ajax({
	          	url:'{{ (path('show_teacher_details')) }}',
	          	type: "POST",
	          	dataType: "json",
	          	data: {
	              	"info": id,
	          	},
	          	async: true,
	          	success: function (data)
	          	{
	              	$(".modal-body-"+data[0]).html(
	              		data[1]
	              	);
	              	
	          	},	
	         	error: function () {
	              	$("#info").html("<b>something's wrong</b>");
	       	 	}
	      	});

	  	});
  	</script>
  	<script>
  	    $(document).on('click', '#auto', function(){
  	    	var timetableId = {{timetable.id}};
  	    	var auto_quantity = $("#auto_quantity").val();
  	    	var auto_subject = $(".auto_subject").val();
  	    	var auto_class = $(".auto_class").val();
	      	$.ajax({
	          	url:'{{ (path('save_entries_auto')) }}',
	          	type: "POST",
	          	dataType: "json",
	          	data: {
	              	"timetableId": timetableId,
	              	"auto_quantity": auto_quantity,
	              	"auto_subject": auto_subject,
	              	"auto_class": auto_class,
	          	},
	          	async: true,
	          	success: function (data)
	          	{
					console.log(data);
					// location.reload();
					// $.each(data, function( index, value ) {
					// 	$("."+value).css("background-color", "yellow");
					// });
						          	
				},	
	         	error: function () {
	              	$("#info").html("<b>something's wrong</b>");
	       	 	}
	      	});

	  	});
  	</script>
	<script type="text/javascript">
  	    $(document).on('click', '[id^="fixLesson_"]', function(){
			if ($('#forceEntry').is(':checked')) {
		        var forced = 'true';
		    } else {
		        var forced = 'false';
		    }

  	    	var id = jQuery(this).attr("id");
  	    	var timetable = {{timetable.id}};
  	    	var classSubj = 0;
  	    	var subject = $("#subjectFixed").val();
  	    	var teacher = $("#teacherFixed").val();

	      	$.ajax({
	          	url:'{{ (path('fix_timetable_entry')) }}',
	          	type: "POST",
	          	dataType: "json",
	          	data: {
	              	"info": id,
	              	"classSubj": classSubj,
	              	"subject": subject,
	              	"teacher": teacher,
	              	"forced": forced,
	              	"timetable": timetable,
	          	},
	          	async: true,
	          	success: function (data)
	          	{
	              	$("."+data.output['string']).css(
	              		{
	              			"background-color" : data.output['color'],
	              			"font-size" : "15px",
	              			"font-weight" : "bold",
	              			"padding" : "2px",
	              			"border" : "1px solid fff"
	              		}).text(data.output['subject']);
	              	// $("#info").html(data.message);
	              	$.notiny({ 
		            	text: data.message,  
		            	position: 'right-top',
		            	delay: 5000,
		            	theme: data.theme
		            });
	          	},	
	         	error: function () {
	              	$("#info").html("<b>something's wrong</b>");
	       	 	}
	      	});
	    });

	</script>
	<script type="text/javascript">
		$(document).on('change', '.fixTeacher', function() {
			console.log($( this ).val());
	      $("#teacherFixed").val($( this ).val());
		});

		$(document).on('change', '.fixSubject', function() {
			console.log($( this ).val());
	      $("#subjectFixed").val($( this ).val());
		});

	</script>
{% endblock %}

{# purchase / 0.55 = reporting price //what I heard
purchase / 0.755 = reporting price //what I think is the case


reporting price = 6000


tithe = 6000 X .045 (270)
5% = 6000 X .05 (300)
tax = 6000 X .16 (960)

kimomi 

6000 X .755 = purchasing price  no savings (4530)
6000 X .805 = purchasing price with savings (4830) #}
{# settings:

error proof / crash proof
hints
number of lessons per teacher on click

 #}